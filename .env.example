# =============================================================================
# Collabora Standalone - Environment Configuration
# =============================================================================
# Copy this file to .env and customize for your environment
#
# IMPORTANT: Generate secure secrets before deployment!
# Run: ./scripts/generate-secrets.sh
# Or manually generate each secret with: openssl rand -hex 32
#
# WARNING: Never commit the actual .env file with real secrets to version control!

# -----------------------------------------------------------------------------
# Domain Configuration
# -----------------------------------------------------------------------------
DOMAIN=localhost

# -----------------------------------------------------------------------------
# Collabora Admin Console (/browser/dist/admin/admin.html)
# -----------------------------------------------------------------------------
COLLABORA_ADMIN_USER=admin
# Generate with: openssl rand -base64 24
COLLABORA_ADMIN_PASSWORD=CHANGE_ME_GENERATE_SECURE_PASSWORD

# -----------------------------------------------------------------------------
# Security Secrets (REQUIRED - Generate before first run!)
# -----------------------------------------------------------------------------
# Generate each with: openssl rand -hex 32
JWT_SECRET=CHANGE_ME_GENERATE_WITH_openssl_rand_-hex_32
WOPI_SECRET=CHANGE_ME_GENERATE_WITH_openssl_rand_-hex_32

# -----------------------------------------------------------------------------
# PostgreSQL Database
# -----------------------------------------------------------------------------
POSTGRES_USER=collabora
# Generate with: openssl rand -base64 24
POSTGRES_PASSWORD=CHANGE_ME_GENERATE_SECURE_PASSWORD
POSTGRES_DB=collabora_db

# -----------------------------------------------------------------------------
# Application Settings
# -----------------------------------------------------------------------------
NODE_ENV=development
LOG_LEVEL=debug
LOG_TO_FILE=false

# Storage limits
MAX_UPLOAD_SIZE=100
STORAGE_QUOTA_PER_USER=5368709120

# Session timeout (seconds)
SESSION_TIMEOUT=86400

# Rate limiting
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=900

# -----------------------------------------------------------------------------
# Authentication Mode
# -----------------------------------------------------------------------------
# Options: local, ldap, ltpa, ldap_ltpa, hybrid
# - local: Database users only (default)
# - ldap: LDAP/Active Directory authentication
# - ltpa: IBM WebSphere LTPA2 SSO
# - ldap_ltpa: Combined LDAP + LTPA (SSO with LDAP validation)
# - hybrid: LDAP with local fallback
AUTH_MODE=local

# -----------------------------------------------------------------------------
# LDAP Configuration (for AUTH_MODE=ldap, hybrid, or ldap_ltpa)
# Supports: IBM Domino LDAP, Active Directory, OpenLDAP, 389 Directory
# Note: Do NOT wrap filter values in quotes
# -----------------------------------------------------------------------------
# Debug logging (set to true for detailed LDAP troubleshooting)
DEBUG_LDAP=false

# Server type: auto (auto-detect), domino, ad, openldap
# 'auto' detects Domino from baseDN pattern (o=OrgName)
LDAP_SERVER_TYPE=auto

LDAP_URL=ldap://ldap.example.com:389
LDAP_BASE_DN=dc=example,dc=com
LDAP_BIND_DN=cn=service,dc=example,dc=com
LDAP_BIND_PASSWORD=

# User search base (leave empty to search from baseDN directly - required for Domino)
LDAP_USER_SEARCH_BASE=ou=users

# Search filter - use {{username}} as placeholder for the login identifier
# NOTE: For Domino, if no filter is set the system auto-defaults to:
#   (|(mail={{username}})(cn={{username}})(shortName={{username}}))
LDAP_USER_SEARCH_FILTER=(uid={{username}})
# Filter examples per server type:
#   OpenLDAP:           (uid={{username}})
#   OpenLDAP+email:     (|(uid={{username}})(mail={{username}}))
#   Domino (multi):     (|(mail={{username}})(cn={{username}})(shortName={{username}}))
#   Domino by email:    (&(mail={{username}})(objectclass=dominoPerson))
#   Domino by CN:       (&(cn={{username}})(objectclass=dominoPerson))
#   Domino by short:    (&(shortName={{username}})(objectclass=dominoPerson))
#   Domino by internet: (&(internetAddress={{username}})(objectclass=dominoPerson))
#   Active Directory:   (&(sAMAccountName={{username}})(objectclass=user))
#   AD by email:        (&(userPrincipalName={{username}})(objectclass=user))

LDAP_GROUP_SEARCH_BASE=
LDAP_GROUP_SEARCH_FILTER=(member={{dn}})
LDAP_USERNAME_ATTR=uid
LDAP_EMAIL_ATTR=mail
LDAP_DISPLAY_NAME_ATTR=cn
LDAP_ADMIN_GROUP=cn=admins
LDAP_TLS_REJECT_UNAUTHORIZED=true
LDAP_TIMEOUT=15000
LDAP_CONNECT_TIMEOUT=15000
LDAP_IDLE_TIMEOUT=30000
# Set to true to also search by email field
LDAP_SEARCH_BY_EMAIL=false

# --- Example: IBM Domino LDAP ---
# LDAP_SERVER_TYPE=domino
# LDAP_URL=ldap://domino.example.com:389
# LDAP_BASE_DN=o=MyOrganization
# LDAP_BIND_DN=cn=LDAP Service,o=MyOrganization
# LDAP_BIND_PASSWORD=secret
# LDAP_USER_SEARCH_BASE=
# LDAP_USER_SEARCH_FILTER=(|(mail={{username}})(cn={{username}})(shortName={{username}}))
# LDAP_USERNAME_ATTR=cn
# LDAP_EMAIL_ATTR=mail
# LDAP_DISPLAY_NAME_ATTR=cn

# --- Example: Active Directory ---
# LDAP_SERVER_TYPE=ad
# LDAP_URL=ldap://dc.example.com:389
# LDAP_BASE_DN=dc=example,dc=com
# LDAP_BIND_DN=cn=svc-ldap,cn=Users,dc=example,dc=com
# LDAP_BIND_PASSWORD=secret
# LDAP_USER_SEARCH_BASE=cn=Users
# LDAP_USER_SEARCH_FILTER=(&(sAMAccountName={{username}})(objectclass=user))
# LDAP_USERNAME_ATTR=sAMAccountName
# LDAP_EMAIL_ATTR=mail
# LDAP_DISPLAY_NAME_ATTR=displayName

# -----------------------------------------------------------------------------
# LTPA2 SSO Configuration (for AUTH_MODE=ltpa, ldap_ltpa, or hybrid)
# Supports: IBM Domino, WebSphere, Liberty
# -----------------------------------------------------------------------------
# Debug logging for LTPA token troubleshooting
DEBUG_LTPA=false

# Get the 3DES key from your Domino/WebSphere ltpa.keys file
# (com.ibm.websphere.ltpa.3DESKey value)
LTPA_SECRET_KEY=
LTPA_PUBLIC_KEY=
LTPA_PRIVATE_KEY=
# Cookie names - Domino uses LtpaToken2 (LTPA2) and LtpaToken (LTPA1)
LTPA_COOKIE_NAME=LtpaToken2
LTPA_COOKIE_NAME_FALLBACK=LtpaToken
LTPA_REALM=defaultRealm
LTPA_TOKEN_EXPIRATION=7200
LTPA_TRUSTED_DOMAINS=
# How to extract username from Domino DN in LTPA token
# Options: cn (default), uid, shortname, dn, email
LTPA_DOMINO_USER_FORMAT=cn
# Set to true if your server uses AES encryption instead of 3DES
LTPA_PREFER_AES=false
